# adapted from https://github.com/microsoft/vscode-dev-containers/blob/main/containers/javascript-node-mongo/.devcontainer/docker-compose.yml
# Note: the "ports" property in this file will not forward from a codespace; add to "forwardPorts" in devcontainer.json instead
version: '3.8'

services:
  # mongodb_container:
  #   image: mongo:latest
  #   environment:
  #     MONGO_INITDB_ROOT_USERNAME: root
  #     MONGO_INITDB_ROOT_PASSWORD: rootpassword
  #   ports:
  #     - 27017:27017
  sailbot-workspace:
    build:
      context: .
      dockerfile: Dockerfile

    # NOTE: CI reads environment variables from sailbot_workspace/.github/workflows/test_definitions.yml instead of here
    environment:
      - MONGODB_CONN_STR=mongodb://root:rootpassword@mongodb_container:27017
    # Initialize mongodb and keep the service running
    # command: '/bin/bash -c "sleep 5; mongosh $$CONN_STR --eval \"show dbs;\""; sleep infinity'
    command: 'sleep infinity'
    depends_on:
      - mongodb_container

  # # URL: mongodb://mongodb:27017
  mongodb_container:
    image: mongo:latest
    restart: unless-stopped
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: rootpassword
    ports:
      - 27017:27017


    # Uncomment to change startup options
    # environment:
    #  MONGO_INITDB_ROOT_USERNAME: root
    #  MONGO_INITDB_ROOT_PASSWORD: example
    #  MONGO_INITDB_DATABASE: your-database-here
