name: 'Test'
description: 'Test using devcontainer'

inputs:
  disable_vcs:
    description: 'Whether to disable VCS cloning all repositories'
    required: true

runs:
  using: "composite"
  steps:
    # TODO: remove once monorepo and combine website docker compose into main one
    - name: Setup Code
      shell: bash
      run: |
        docker compose -f .devcontainer/docker-compose.yml up -d
        docker compose -f .devcontainer/docker-compose.yml exec -T sailbot-workspace /bin/bash -c "export DISABLE_VCS=${{ inputs.disable_vcs }} && cd /workspaces/sailbot_workspace && ./setup.sh"

    - name: Run Containers
      shell: bash
      run: docker compose -f .devcontainer/docker-compose.yml -f .devcontainer/docker-compose.website.yml up -d

    - name: Run Tests
      shell: bash
      run: docker compose -f .devcontainer/docker-compose.yml -f .devcontainer/docker-compose.website.yml exec -T sailbot-workspace /bin/bash -c "export DISABLE_VCS=${{ inputs.disable_vcs }} && cd /workspaces/sailbot_workspace && .github/actions/test/run.sh"
