#!/usr/bin/bash
SCRIPT_DIR="$(dirname "$(readlink -f "$0")")"
TESTPLAN_DIR=$SCRIPT_DIR/../testplans
TESTPLANS=$(ls $TESTPLAN_DIR | grep ".yaml")

echo "Cleaning .yaml files in $SCRIPT_DIR/ ..."
rm -f $SCRIPT_DIR/*.yaml

for TESTPLAN in $TESTPLANS
do
    INFILE=$TESTPLAN_DIR/$TESTPLAN
    OUTFILE=$SCRIPT_DIR/$TESTPLAN
    echo "Generating ROS parameter file \"$OUTFILE\" for testplan \"$INFILE\""
    echo "# AUTOGENERATED FILE - DO NOT EDIT" > $OUTFILE
    echo "# ROS launch config wrapper for $INFILE" >> $OUTFILE
    echo "integration_test_node:" >> $OUTFILE
    echo "  ros__parameters:" >> $OUTFILE
    echo "    testplan: $(readlink -f $INFILE)" >> $OUTFILE
done
