{"version":3,"file":"walkGherkinDocument.js","sourceRoot":"","sources":["../../src/walkGherkinDocument.ts"],"names":[],"mappings":"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","sourcesContent":["import * as messages from '@cucumber/messages'\nimport { GherkinDocumentHandlers } from './GherkinDocumentHandlers'\n\n/**\n * Walks a Gherkin Document, visiting each node depth first (in the order they appear in the source)\n *\n * @param gherkinDocument\n * @param initialValue the initial value of the traversal\n * @param handlers handlers for each node type, which may return a new value\n * @return result the final value\n */\nexport function walkGherkinDocument<Acc>(\n  gherkinDocument: messages.GherkinDocument,\n  initialValue: Acc,\n  handlers: Partial<GherkinDocumentHandlers<Acc>>\n): Acc {\n  let acc = initialValue\n  const h: GherkinDocumentHandlers<Acc> = { ...makeDefaultHandlers<Acc>(), ...handlers }\n  const feature = gherkinDocument.feature\n  if (!feature) return acc\n  acc = walkTags(feature.tags || [], acc)\n  acc = h.feature(feature, acc)\n\n  for (const child of feature.children) {\n    if (child.background) {\n      acc = walkStepContainer(child.background, acc)\n    } else if (child.scenario) {\n      acc = walkStepContainer(child.scenario, acc)\n    } else if (child.rule) {\n      acc = walkTags(child.rule.tags || [], acc)\n      acc = h.rule(child.rule, acc)\n      for (const ruleChild of child.rule.children) {\n        if (ruleChild.background) {\n          acc = walkStepContainer(ruleChild.background, acc)\n        } else if (ruleChild.scenario) {\n          acc = walkStepContainer(ruleChild.scenario, acc)\n        }\n      }\n    }\n  }\n  return acc\n\n  function walkTags(tags: readonly messages.Tag[], acc: Acc): Acc {\n    return tags.reduce((acc, tag) => h.tag(tag, acc), acc)\n  }\n\n  function walkSteps(steps: readonly messages.Step[], acc: Acc): Acc {\n    return steps.reduce((acc, step) => walkStep(step, acc), acc)\n  }\n\n  function walkStep(step: messages.Step, acc: Acc): Acc {\n    acc = h.step(step, acc)\n    if (step.docString) {\n      acc = h.docString(step.docString, acc)\n    }\n    if (step.dataTable) {\n      acc = h.dataTable(step.dataTable, acc)\n      acc = walkTableRows(step.dataTable.rows, acc)\n    }\n    return acc\n  }\n\n  function walkTableRows(tableRows: readonly messages.TableRow[], acc: Acc): Acc {\n    return tableRows.reduce((acc, tableRow) => walkTableRow(tableRow, acc), acc)\n  }\n\n  function walkTableRow(tableRow: messages.TableRow, acc: Acc): Acc {\n    acc = h.tableRow(tableRow, acc)\n    return tableRow.cells.reduce((acc, tableCell) => h.tableCell(tableCell, acc), acc)\n  }\n\n  function walkStepContainer(\n    stepContainer: messages.Scenario | messages.Background,\n    acc: Acc\n  ): Acc {\n    const scenario: messages.Scenario = 'tags' in stepContainer ? stepContainer : null\n    acc = walkTags(scenario?.tags || [], acc)\n    acc = scenario\n      ? h.scenario(scenario, acc)\n      : h.background(stepContainer as messages.Background, acc)\n    acc = walkSteps(stepContainer.steps, acc)\n\n    if (scenario) {\n      for (const examples of scenario.examples || []) {\n        acc = walkTags(examples.tags || [], acc)\n        acc = h.examples(examples, acc)\n        if (examples.tableHeader) {\n          acc = walkTableRow(examples.tableHeader, acc)\n          acc = walkTableRows(examples.tableBody || [], acc)\n        }\n      }\n    }\n    return acc\n  }\n}\n\nfunction makeDefaultHandlers<Acc>() {\n  const defaultHandlers: GherkinDocumentHandlers<Acc> = {\n    feature(feature, acc) {\n      return acc\n    },\n    background(background, acc) {\n      return acc\n    },\n    rule(rule, acc) {\n      return acc\n    },\n    scenario(scenario, acc) {\n      return acc\n    },\n    step(step, acc) {\n      return acc\n    },\n    examples(examples, acc) {\n      return acc\n    },\n    tag(tag, acc) {\n      return acc\n    },\n    comment(comment, acc) {\n      return acc\n    },\n    dataTable(dataTable, acc) {\n      return acc\n    },\n    tableRow(tableRow, acc) {\n      return acc\n    },\n    tableCell(tableCell, acc) {\n      return acc\n    },\n    docString(docString, acc) {\n      return acc\n    },\n  }\n  return defaultHandlers\n}\n"]}