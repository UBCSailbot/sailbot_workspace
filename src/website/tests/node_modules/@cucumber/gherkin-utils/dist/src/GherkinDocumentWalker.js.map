{"version":3,"file":"GherkinDocumentWalker.js","sourceRoot":"","sources":["../../src/GherkinDocumentWalker.ts"],"names":[],"mappings":"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","sourcesContent":["// This file is DEPRECATED - use ./walkGherkinDocument instead\nimport * as messages from '@cucumber/messages'\n\nexport interface IFilters {\n  acceptScenario?: (scenario: messages.Scenario) => boolean\n  acceptStep?: (step: messages.Step) => boolean\n  acceptBackground?: (background: messages.Background) => boolean\n  acceptRule?: (rule: messages.Rule) => boolean\n  acceptFeature?: (feature: messages.Feature) => boolean\n}\n\nexport interface IHandlers {\n  handleStep?: (step: messages.Step) => void\n  handleScenario?: (scenario: messages.Scenario) => void\n  handleBackground?: (background: messages.Background) => void\n  handleRule?: (rule: messages.Rule) => void\n  handleFeature?: (feature: messages.Feature) => void\n}\n\nconst defaultFilters: IFilters = {\n  acceptScenario: () => true,\n  acceptStep: () => true,\n  acceptBackground: () => true,\n  acceptRule: () => true,\n  acceptFeature: () => true,\n}\n\nexport const rejectAllFilters: IFilters = {\n  acceptScenario: () => false,\n  acceptStep: () => false,\n  acceptBackground: () => false,\n  acceptRule: () => false,\n  acceptFeature: () => false,\n}\n\nconst defaultHandlers: IHandlers = {\n  handleStep: () => null,\n  handleScenario: () => null,\n  handleBackground: () => null,\n  handleRule: () => null,\n  handleFeature: () => null,\n}\n\nexport default class GherkinDocumentWalker {\n  private readonly filters: IFilters\n  private readonly handlers: IHandlers\n\n  constructor(filters?: IFilters, handlers?: IHandlers) {\n    this.filters = { ...defaultFilters, ...filters }\n    this.handlers = { ...defaultHandlers, ...handlers }\n  }\n\n  public walkGherkinDocument(\n    gherkinDocument: messages.GherkinDocument\n  ): messages.GherkinDocument | null {\n    if (!gherkinDocument.feature) {\n      return null\n    }\n\n    const feature = this.walkFeature(gherkinDocument.feature)\n\n    if (!feature) {\n      return null\n    }\n\n    return {\n      feature,\n      comments: gherkinDocument.comments,\n      uri: gherkinDocument.uri,\n    }\n  }\n\n  protected walkFeature(feature: messages.Feature): messages.Feature {\n    const keptChildren = this.walkFeatureChildren(feature.children)\n\n    this.handlers.handleFeature(feature)\n\n    const backgroundKept = keptChildren.find((child) => child.background)\n\n    if (this.filters.acceptFeature(feature) || backgroundKept) {\n      return this.copyFeature(\n        feature,\n        feature.children.map((child) => {\n          if (child.background) {\n            return {\n              background: this.copyBackground(child.background),\n            }\n          }\n          if (child.scenario) {\n            return {\n              scenario: this.copyScenario(child.scenario),\n            }\n          }\n          if (child.rule) {\n            return {\n              rule: this.copyRule(child.rule, child.rule.children),\n            }\n          }\n        })\n      )\n    }\n\n    if (keptChildren.find((child) => child !== null)) {\n      return this.copyFeature(feature, keptChildren)\n    }\n  }\n\n  private copyFeature(\n    feature: messages.Feature,\n    children: messages.FeatureChild[]\n  ): messages.Feature {\n    return {\n      children: this.filterFeatureChildren(feature, children),\n      location: feature.location,\n      language: feature.language,\n      keyword: feature.keyword,\n      name: feature.name,\n      description: feature.description,\n      tags: this.copyTags(feature.tags),\n    }\n  }\n\n  private copyTags(tags: readonly messages.Tag[]): messages.Tag[] {\n    return tags.map((tag) => ({\n      name: tag.name,\n      id: tag.id,\n      location: tag.location,\n    }))\n  }\n\n  private filterFeatureChildren(\n    feature: messages.Feature,\n    children: messages.FeatureChild[]\n  ): messages.FeatureChild[] {\n    const copyChildren: messages.FeatureChild[] = []\n\n    const scenariosKeptById = new Map(\n      children.filter((child) => child.scenario).map((child) => [child.scenario.id, child])\n    )\n\n    const ruleKeptById = new Map(\n      children.filter((child) => child.rule).map((child) => [child.rule.id, child])\n    )\n\n    for (const child of feature.children) {\n      if (child.background) {\n        copyChildren.push({\n          background: this.copyBackground(child.background),\n        })\n      }\n\n      if (child.scenario) {\n        const scenarioCopy = scenariosKeptById.get(child.scenario.id)\n        if (scenarioCopy) {\n          copyChildren.push(scenarioCopy)\n        }\n      }\n\n      if (child.rule) {\n        const ruleCopy = ruleKeptById.get(child.rule.id)\n        if (ruleCopy) {\n          copyChildren.push(ruleCopy)\n        }\n      }\n    }\n    return copyChildren\n  }\n\n  private walkFeatureChildren(children: readonly messages.FeatureChild[]): messages.FeatureChild[] {\n    const childrenCopy: messages.FeatureChild[] = []\n\n    for (const child of children) {\n      let backgroundCopy: messages.Background = null\n      let scenarioCopy: messages.Scenario = null\n      let ruleCopy: messages.Rule = null\n\n      if (child.background) {\n        backgroundCopy = this.walkBackground(child.background)\n      }\n      if (child.scenario) {\n        scenarioCopy = this.walkScenario(child.scenario)\n      }\n      if (child.rule) {\n        ruleCopy = this.walkRule(child.rule)\n      }\n\n      if (backgroundCopy || scenarioCopy || ruleCopy) {\n        childrenCopy.push({\n          background: backgroundCopy,\n          scenario: scenarioCopy,\n          rule: ruleCopy,\n        })\n      }\n    }\n\n    return childrenCopy\n  }\n\n  protected walkRule(rule: messages.Rule): messages.Rule {\n    const children = this.walkRuleChildren(rule.children)\n\n    this.handlers.handleRule(rule)\n\n    const backgroundKept = children.find((child) => child !== null && child.background !== null)\n    const scenariosKept = children.filter((child) => child !== null && child.scenario !== null)\n\n    if (this.filters.acceptRule(rule) || backgroundKept) {\n      return this.copyRule(rule, rule.children)\n    }\n    if (scenariosKept.length > 0) {\n      return this.copyRule(rule, scenariosKept)\n    }\n  }\n\n  private copyRule(rule: messages.Rule, children: readonly messages.RuleChild[]): messages.Rule {\n    return {\n      id: rule.id,\n      name: rule.name,\n      description: rule.description,\n      location: rule.location,\n      keyword: rule.keyword,\n      children: this.filterRuleChildren(rule.children, children),\n      tags: this.copyTags(rule.tags),\n    }\n  }\n\n  private filterRuleChildren(\n    children: readonly messages.RuleChild[],\n    childrenKept: readonly messages.RuleChild[]\n  ): messages.RuleChild[] {\n    const childrenCopy: messages.RuleChild[] = []\n    const scenariosKeptIds = childrenKept\n      .filter((child) => child.scenario)\n      .map((child) => child.scenario.id)\n\n    for (const child of children) {\n      if (child.background) {\n        childrenCopy.push({\n          background: this.copyBackground(child.background),\n        })\n      }\n      if (child.scenario && scenariosKeptIds.includes(child.scenario.id)) {\n        childrenCopy.push({\n          scenario: this.copyScenario(child.scenario),\n        })\n      }\n    }\n\n    return childrenCopy\n  }\n\n  private walkRuleChildren(children: readonly messages.RuleChild[]): messages.RuleChild[] {\n    const childrenCopy: messages.RuleChild[] = []\n\n    for (const child of children) {\n      if (child.background) {\n        childrenCopy.push({\n          background: this.walkBackground(child.background),\n        })\n      }\n      if (child.scenario) {\n        childrenCopy.push({\n          scenario: this.walkScenario(child.scenario),\n        })\n      }\n    }\n    return childrenCopy\n  }\n\n  protected walkBackground(background: messages.Background): messages.Background {\n    const steps = this.walkAllSteps(background.steps)\n    this.handlers.handleBackground(background)\n\n    if (this.filters.acceptBackground(background) || steps.find((step) => step !== null)) {\n      return this.copyBackground(background)\n    }\n  }\n\n  private copyBackground(background: messages.Background): messages.Background {\n    return {\n      id: background.id,\n      name: background.name,\n      location: background.location,\n      keyword: background.keyword,\n      steps: background.steps.map((step) => this.copyStep(step)),\n      description: background.description,\n    }\n  }\n\n  protected walkScenario(scenario: messages.Scenario): messages.Scenario {\n    const steps = this.walkAllSteps(scenario.steps)\n    this.handlers.handleScenario(scenario)\n\n    if (this.filters.acceptScenario(scenario) || steps.find((step) => step !== null)) {\n      return this.copyScenario(scenario)\n    }\n  }\n\n  private copyScenario(scenario: messages.Scenario): messages.Scenario {\n    return {\n      id: scenario.id,\n      name: scenario.name,\n      description: scenario.description,\n      location: scenario.location,\n      keyword: scenario.keyword,\n      examples: scenario.examples,\n      steps: scenario.steps.map((step) => this.copyStep(step)),\n      tags: this.copyTags(scenario.tags),\n    }\n  }\n\n  protected walkAllSteps(steps: readonly messages.Step[]): messages.Step[] {\n    return steps.map((step) => this.walkStep(step))\n  }\n\n  protected walkStep(step: messages.Step): messages.Step {\n    this.handlers.handleStep(step)\n    if (!this.filters.acceptStep(step)) {\n      return null\n    }\n    return this.copyStep(step)\n  }\n\n  private copyStep(step: messages.Step): messages.Step {\n    return {\n      id: step.id,\n      keyword: step.keyword,\n      keywordType: step.keywordType,\n      location: step.location,\n      text: step.text,\n      dataTable: step.dataTable,\n      docString: step.docString,\n    }\n  }\n}\n"]}